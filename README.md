---
# SETTINGUP A JAVASCRIPT DEVELOPMENT ENVIRONMENT
---

* Start Date: 04 Mar 2017 

* This markdown file was written based on the guidlines [here](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)

* You can also use: <https://stackedit.io> to create a .md file in a WYSIWYG fashion.

* git repo: https://github.com/zonender/react-redux-weback2-starter

* Author: [Asim Abdelgadir](https://github.com/zonender)

* OS: Windows 10 (64-bit)

* Browser: Chrome Version 56.0.2924.87 (64-bit)

* Editor: Visual Studio Code version 1.10.1

* VS CODE File Icon theme: Go to the plugins side menu: type: vscode-icons, locate the plugin, install it, reload, then goto File > Preferences > select "File Icon Theme".

* Node version: 7.5.0

* npm version: 4.2.0

* Command language (SHELL): Git Bash version: 2.11.1 (64-bit)

* Version control: Git version: 2.11.1 (64-bit) and <www.github.com>

> **_//==============================================================\\_**
>
> **_.GITIGNORE AND README.MD_**
>
> **_\\==============================================================//_**

01. ) Start with an empty folder in your desktop and call it "react-redux-weback2-starter" or any other name you choose, this is going to be your root directory, and we 
will call it your root.

01. ) Create README.md file in your root and write the following in it:
  
   01. ) describe every step taken.
  
   01. ) every file created.
  
   01. ) every code written, new or updated and which file it was written in, you write the line(s) of code in one section and then copy and paste the entire file into a 
   separate section underneath it.
  
   01. ) every issue encountered, steps to reproduce, why it happened if possible and how it was solved with references and links.

01. ) Create .gitignore with the following content:

```
# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directory
# https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git
node_modules

#dist folder
dist

#build folder
build

#Webstorm metadata
.idea

# Mac files
.DS_Store
```

> **_//==============================================================\\_**
>
> **_EDITOR AND CONFIGURATION | EDITORCONFIG_**
>
> **_\\==============================================================//_**

To make sure everyone inn your team, if you are working with a team, is using the same editor setting we will enforce these setting through the editor config file.

01. ) Create the file .editorconfig in your root with the following content, All future files created will be formatted based on the settings in this file.

  ```
  # editorconfig.org
  root = true

  [*]
  indent_style = space
  indent_size = 2
  end_of_line = lf
  charset = utf-8
  trim_trailing_whitespace = true
  insert_final_newline = true

  [*.md]
  trim_trailing_whitespace = false
  ```

01. ) Go to <www.editorconfig.org> to download and install your editor's plugin, now your editor will enforce the setting in the .editorconfig, 
don't forget to enable the plugin after you installed it. 

> **_//==============================================================\\_**
>
> **_.GITIGNORE AND README.MD_**
>
> **_\\==============================================================//_**

01. ) Start with an empty folder in your desktop and call it "react-redux-weback2-starter" or any other name you choose, this is going to be your root directory, and we 
will call it your root.

01. ) Create README.md file in your root and write the following in it:
  
   01. ) describe every step taken.
  
   01. ) every file created.
  
   01. ) every code written, new or updated and which file it was written in, you write the line(s) of code in one section and then copy and paste the entire file into a 
   separate section underneath it.
  
   01. ) every issue encountered, steps to reproduce, why it happened if possible and how it was solved with references and links.

01. ) Create .gitignore with the following content:

```
# Logs
logs
*.log

# Runtime data
pids
*.pid
*.seed

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directory
# https://www.npmjs.org/doc/misc/npm-faq.html#should-i-check-my-node_modules-folder-into-git
node_modules

#dist folder
dist

#build folder
build

#Webstorm metadata
.idea

# Mac files
.DS_Store
```

> **_//==============================================================\\_**
>
> **_EDITOR AND CONFIGURATION | EDITORCONFIG_**
>
> **_\\==============================================================//_**

To make sure everyone inn your team, if you are working with a team, is using the same editor setting we will enforce these setting through the editor config file.

01. ) Create the file .editorconfig in your root with the following content, All future files created will be formatted based on the settings in this file.

  ```
  # editorconfig.org
  root = true

  [*]
  indent_style = space
  indent_size = 2
  end_of_line = lf
  charset = utf-8
  trim_trailing_whitespace = true
  insert_final_newline = true

  [*.md]
  trim_trailing_whitespace = false
  ```

01. ) Go to <www.editorconfig.org> to download and install your editor's plugin, now your editor will enforce the setting in the .editorconfig, 
don't forget to enable the plugin after you installed it. 

> **_//==============================================================\\_**
>
> **_INSTALL NODE, NPM, GIT, BASH AND NSP_**
>
> **_\\==============================================================//_**

01. ) install node.js from: <https://nodejs.org/en/>

01. ) npm is part of the node.js installation, however, you can install it from the command line:

```
npm install npm -g
```

01. ) Install Git from: <https://git-scm.com/> this will also install Git Bash command line.

01. ) To Use Git Bash terminal within VS Code: <https://code.visualstudio.com/docs/editor/integrated-terminal>, this is very convenient.

01. ) Create a file called package.json in your root and paste the content of this [package.json](https://gist.github.com/zonender/40564da81b864b3654ac98ab30940fbb) inside
 the package.json you just created, then save it.

For your convenience and just incase you were unable to get the package.json from the link above, copy and paste the following code inside the package.json file:

```
{
  "name": "rreact-redux-weback2-starter",
  "version": "1.0.0",
  "description": "Starter kit with React, Redux and Webpack2",
  "scripts": {

  },
  "author": "Asim Abdelgadir",
  "license": "MIT",
  "dependencies": {
    "babel-polyfill": "6.8.0",
    "bootstrap": "3.3.6",
    "jquery": "2.2.3",
    "react": "15.0.2",
    "react-dom": "15.0.2",
    "react-redux": "4.4.5",
    "react-router": "2.4.0",
    "react-router-redux": "4.0.4",
    "redux": "3.5.2",
    "redux-thunk": "2.0.1",
    "toastr": "2.1.2"
  },
  "devDependencies": {
    "babel-cli": "6.8.0",
    "babel-core": "6.8.0",
    "babel-loader": "6.2.4",
    "babel-plugin-react-display-name": "2.0.0",
    "babel-preset-es2015": "6.6.0",
    "babel-preset-react": "6.5.0",
    "babel-preset-react-hmre": "1.1.1",
    "babel-register": "6.8.0",
    "cheerio": "0.22.0",
    "colors": "1.1.2",
    "compression": "1.6.1",
    "cross-env": "1.0.7",
    "css-loader": "^0.23.1",
    "enzyme": "2.2.0",
    "eslint": "2.9.0",
    "eslint-plugin-import": "1.6.1",
    "eslint-plugin-react": "5.0.1",
    "eslint-watch": "2.1.11",
    "eventsource-polyfill": "0.9.6",
    "expect": "1.19.0",
    "express": "4.13.4",
    "extract-text-webpack-plugin": "1.0.1",
    "file-loader": "0.8.5",
    "html-webpack-plugin": "^2.28.0",
    "jsdom": "8.5.0",
    "localtunnel": "^1.8.2",
    "mocha": "2.4.5",
    "nock": "8.0.0",
    "npm-run-all": "1.8.0",
    "nsp": "^2.6.2",
    "open": "0.0.5",
    "react-addons-test-utils": "15.0.2",
    "redux-immutable-state-invariant": "1.2.3",
    "redux-mock-store": "1.0.2",
    "rimraf": "^2.5.2",
    "style-loader": "^0.13.1",
    "url-loader": "^0.5.7",
    "webpack": "1.13.0",
    "webpack-dev-middleware": "1.6.1",
    "webpack-hot-middleware": "2.10.0",
    "webpack-md5-hash": "0.0.5"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/zonender/react-redux-weback2-starter"
  }
}
```

01. ) Then run:

```
npm install
```

This will install all the dependencies in the package.json to our project.

01. ) To scan all the dependencies in the package.json file we can use Node Security Platform, it is already part of the devDependencies in the package.json file, 
but if you still want to install it run this command in your terminal/command line, going forward, when we say "run this command" we are refering to running the command
from within the terminal/command line:

```
npm install nsp --save-dev
```

then to run the security check run this command:

```
nsp check
```

> **_//==============================================================\\_**
>
> **_SETTING UP EXPRESS AS A DEVELOPMENT WEB SERVER_**
>
> **_\\==============================================================//_**

01. ) Express is already installed in our project as a dev dependency in our package.json, but just incase you need to install it, run this command:

  ```
  npm install express --save-dev
  ```

  We will just need to configure it as follows:

01. ) Create a directory called src in the root, inside it create index.html with this code:

  ```
  <!DOCTYPE html>
  <html lang="en">
    <head>
      <title></title>
      <meta charset="UTF-8">
    </head>
    <body>
      <h1>Hello World!</h1>
    </body>
  </html>
  ```

01. ) It is best to keep all the build tools in a single directory called buildScripts in the root of our project, inside the directory create the file srcServer.js
  in it put this code:
  
  ```
  var express = require('express');
  var path = require('path');
  var open = require('open');

  var port = 3000;
  var app = express();

  app.get('/', function(req, res) {
    res.sendFile(path.join(__dirname, '../src/index.html'));
  });

  app.listen(port, function(err) {
    if (err) {
      console.log(err);
    } else {
      open('http://localhost:' + port);
    }
  });
  ```

  now to run this file with the express server, run this command:

  ```
  node buildScripts/srcServer.js
  ```

  Express will open the browser with the page we just created, now we know we configured express correctly since it is listening to and serving our requests.

  Just in case you ever need to open the index.html without a server, run this command:

  ```
  start src/index.html
  ```

  The page will open in your browser without the server, the page should display only: "Hello World!".

> **_//==============================================================\\_**
>
> **_SETTING UP BABEL (USING ES6)_**
>
> **_\\==============================================================//_**

Transpiling means changing ES6 code (ES2015) into ES5 to ensure our JS code runs in the browsers that do not yet fully support the latest version of JS, we will 
now be using ES5 and Babel will transpile our code to ES5, we already installed Babel when we first ran "npm install" it is one of the many packages included in 
our package.json, so we just have to configure it:

To configure babel:

01. ) Create a file called: .babelrc with the following code:

```
{
  "presets": ["react", "es2015"]
}
```

01. ) To run our app this time we will need to slightly change our command, instead of the key word "node", we will use "babel-node" as follows:

```
babel-node buildScripts/srcServer.js
```

> **_//==============================================================\\_**
>
> **_CREATING A BASIC APP_**
>
> **_\\==============================================================//_**


01. ) Create an src/index.js file with the following code and save it under src:

  ```
  import talk from './talktoconsole';
  console.log(talk(1, 2));

  const button = document.createElement('button');
  button.innerText = 'Click me';
  button.onclick = () => {
      System.import('./image_viewer').then(module => {
          module.default();
      });
  };

  document.body.appendChild(button);
  ```

01. ) Create the file src/talkToConsole.js with the following code:
  
  ```
  import numeral from 'numeral';

  const talk = (a, b) =>numeral(a + b).format('$0.0.00');

  export default talk;
  ```
01. ) Create the file src/image_viewer.js with the following code:

  ```
  import small from '../assets/small.jpg';
  import big from '../assets/big.jpg';
  import './styles/image_viewer.css';

  export default () => {

      const smallImageDescription = document.createElement('p');
      smallImageDescription.innerText = 'This is a small Image that was small enough to be bundled into bundle.js';
      document.body.appendChild(smallImageDescription);

      const smallImage = document.createElement('img');
      smallImage.src = small;
      document.body.appendChild(smallImage);

      const bigImageDescription = document.createElement('p');
      bigImageDescription.innerText = 'This is a big Image, because it is large it was not bundled in bundle.js';
      document.body.appendChild(bigImageDescription);

      const bigImage = document.createElement('img');
      bigImage.src = big;
      document.body.appendChild(bigImage);

      const randomImageDescription = document.createElement('p');
      randomImageDescription.innerText = 'This is a random image generated from http://lorempixel.com/';
      document.body.appendChild(randomImageDescription);

      const randomImage = document.createElement('img');
      randomImage.src = 'http://lorempixel.com/400/200/';
      document.body.appendChild(randomImage);
  };
  ```

01. ) Create a src/styles folder, within the styles folder create a css file src/styles/style.css with the following css code:

```
img {
    border: 10px solid red;
}
```
01. ) Create an assets folder in the root directory and save the following images into them:

http://lorempixel.com/200/200/ - call this small.jpg

http://lorempixel.com/1200/1200/ - call this big.jpg

01. ) Now we must include the three new js files in our src/index.html page as script tags just before the closing "body" tag like this:

```
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="image_viewer.js"></script>
    <script type="text/javascript" src="talkToConsole.js"></script>

```

So our src/index.html becomes:

```
<!DOCTYPE html>
<html lang="en">
  <head>
    <title></title>
    <meta charset="UTF-8">
  </head>
  <body>
    <h1>Hello World!</h1>
    <script type="text/javascript" src="index.js"></script>
    <script type="text/javascript" src="image_viewer.js"></script>
    <script type="text/javascript" src="talkToConsole.js"></script>
  </body>
</html>
```

01. ) Then we have to make sure they are served through the express server by adding the following line in our srcServer.js file:

```
app.use(express.static(path.join(__dirname, '../src')));
```

So our srcServer.js file becomes:

```
import express from 'express';
import path from 'path';
import open from 'open';

const port = 3000;
const app = express();

app.use(express.static(path.join(__dirname, '../src')));

app.get('/', function(req, res) {
  res.sendFile(path.join(__dirname, '../src/index.html'));
});

app.listen(port, function(err) {
  if (err) {
    console.log(err);
  } else {
    open('http://localhost:' + port);
  }
});
```

Now run the app by running the following command, please note that the app will not run as expected:

```
babel-node buildScripts/srcServer.js
```

We are supposed to see a button labeled "Click me", it will not show up, and if you use the "inspect element" tool and open the console, you will see the error message:

  - Uncaught SyntaxError: Unexpected token import      index.js:1
  - Uncaught SyntaxError: Unexpected token import      image_viewer.js:1
  - Uncaught SyntaxError: Unexpected token import      talkToConsole.js:1

This is because the browser is unable to interpret the ES6 "import" statement in the first line of each file, to solve this we will need to install webpack to compile the code and 
bundle it in a single file and in plain JS so that the broweser can understand it and eventually display our button along with its functionality.

> **_//=========================================================================\\_**
>
> **_SETTING UP WEBPACK AS A DEVELOPMENT SERVER AND COMPILING AND BUNDLING OUR CODE_**
>
> **_\\=========================================================================//_**

Now that we have a working app, we can now configure webpack.

  - For more on the configuration of webpack 2: https://github.com/webpack/docs/wiki/configuration
  - For more on webpack's cli commands: https://webpack.github.io/docs/cli.html

01. ) Create a webpack.config.dev.js file in our root with the following code:

    ```
    const webpack = require('webpack');
    const path = require('path');
    const htmlWebpackPlugin = require('html-webpack-plugin');

    //our app third party dependencies
    const VENDOR_LIBS = [
      'babel-polyfill', 'bootstrap', 'jquery', 'numeral', 'react', 'react-dom', 'react-redux',
      'react-router', 'react-router-redux', 'redux', 'redux-thunk', 'toastr'
    ];

    const config = {
      //The entry point for the bundle.
      entry: {
        bundle: path.resolve(__dirname, 'src/index'),
        vendor: VENDOR_LIBS
      },
      output: {
        path: path.join(__dirname, 'build'),
        publicPath: '/',
        filename: '[name][chunkhash].js'
      },
      module: {
        rules: [
          {
            use: 'babel-loader', //here we are selecting the loader
            test: /\.js$/, //and here we specify which file the loader will process
            exclude: /node_modules/
          },
          {
            test: /\.css$/,
            use: ['style-loader', 'css-loader'],
          },
          {
            test: /\.(jpe?g|jpg|png|gif|svg)$/,
            use: [
              {
                loader: 'url-loader',
                options: { limit: 40000 }
              },
              'image-webpack-loader'
            ]
          }
        ]
      },
      plugins: [
          //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there 
          //are it will remove them from bundle.js and put them in vendor.js
          new webpack.optimize.CommonsChunkPlugin({
                names: ['vendor', 'manifest']
          }),
          //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
          new htmlWebpackPlugin({
                template: 'src/index.html' //if we do not specifiy a template, it will use the default one
          }),
          //when reactjs runs it looks for this window scoped variable called process.env.NODE_ENV,
          //if the value of this varaible is production react will not do too many error checking procedures,
          //which also takes too long to run.
          new webpack.DefinePlugin({
            'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
          }),
          new webpack.LoaderOptionsPlugin({
            options: {
                noInfo: false,
                debug: true,
                devtool: 'inline-source-map',
                target: 'web',
            }
          })
      ]
    };

    module.exports = config;
    ```

    - path makes sure we get the path we need regardless of the OS it is running on.

    - __dirname is the current directory. (where webpack.config.dev.js is located)

    - entry: "./src/index.js" is the top level file we want to include in our build.

    - filename: "bundle.js" is the output file that has includes all out JS code.

    Please note that webpack will not physically create a bundle.js file in our directory when we later run "webpack-dev-server", rather it will create everything 
    in memory, the physical file bundle.js and any other required file will be created later when we compile our code using the "webpack" command.

    Webpack will bundle together all our js files into a single file called bundle.js, webpack will also bundle any css,
    and images into the bundle.js file, then webpack will inject this file in the index.html file, so now let's prepare things for webpack before we start using it.

    Webpack will also split our code to improve loaiding performance.

    installing webpack or any other library globally will force your pc to look for the global installation of node_modules under your username folder in your pc, which could include a large number of modules and libraries, this might be slightly slower, it is best to install it locally using "npm install --save-dev" so that next time you run the command npm will look only in our locally installed node_modules, this is faster.

01. ) Remove the script tags that represents our three js files in our src/index.html file, the file becomes:

    ```
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <title></title>
        <meta charset="UTF-8">
      </head>
      <body>
        <h1>Hello World!</h1>
      </body>
    </html>
    ```

01. ) In the buildScripts/srcServer.js file remove the line below which we were using to demonstrate that we can't run our app without compiling it with webpack:

    ```
    app.use(express.static(path.join(__dirname, '../src')));
    ```

    And add the following import statements:

    ```
    import webpack from 'webpack';
    import config from '../webpack.config.dev';
    ```

    Then add the following code:

    ```
    const compiler = webpack(config);

    app.use(require('webpack-dev-middleware')(compiler, {
      noInfo: true,
      publicPath: config.output.publicPath
    }));
    ```

    The final version of our buildScripts/srcServer.js becomes:

    ```
    import express from 'express';
    import path from 'path';
    import open from 'open';
    import webpack from 'webpack';
    import config from '../webpack.config.dev';

    const port = 3000;
    const app = express();
    const compiler = webpack(config);

    app.use(require('webpack-dev-middleware')(compiler, {
      noInfo: true,
      publicPath: config.output.publicPath
    }));

    app.get('/', function(req, res) {
      res.sendFile(path.join(__dirname, '../src/index.html'));
    });

    app.listen(port, function(err) {
      if (err) {
        console.log(err);
      } else {
        open('http://localhost:' + port);
      }
    });
    ```

    With this configuration we can now use webpack as our dev server, to run the project using webpack dev server run this command:

    ```
    webpack-dev-server
    ```

    We can also still run our app through express using the command:

    ```
    babel-node buildScripts/srcServer.js
    ```

    To run our app with the webpack-dev-server we will use this command:

    ```
    webpack-dev-server --config webpack.config.dev.js
    ```

    Running the command "webpack-dev-server" alone like this:

    ```
    webpack-dev-server
    ```

    will have webpack-dev-server assume you are using the default config file name: "webpack.config.js", which is not the case in our app, since our webpack config file is named: "webpack.config.dev.js", we can have several webpack config files if we need.


> **_//==============================================================\\_**
>
> **_SHARING OUR WORK IN PROGRESS WITH LOCALTUNNEL_**
>
> **_\\==============================================================//_**

01. ) Install localtunnel globally:

    ```
    npm install -g localtunnel
    ```

01. ) Run our app:

    ```
    node buildScripts/srcServer.js
    ```

    THe ap will open in the browser, Leave the app running

01. ) Open another command line and run localtunnel from there:

    ```
    lt --port 3000
    ```

    localtunnel will return a url such as: <https://tbwsccjuzv.localtunnel.me/> from which we can access our app, you can provide this url to anyone to share yuor work in progress, 
    we can even use this command:

    ```
    lt --port 3000 --subdomain asimtestapp
    ```

    It should return <https://asimtestapp.localtunnel.me/> that we can use.

> **_//==============================================================\\_**
>
> **_AUTOMATION USING NPM SCRIPTS_**
>
> **_\\==============================================================//_**

npm scripts allows you to: make command line call, utilize npm packages, call separate scripts that use node, call separate files, create, update and remove files and directories
, which is very useful in creating a reliable build process, we can create npm scripts in the "script" section of the package.json.

also, with npm script we do not need to install npm modules globally to run them, when we run "npm install" to install all the packages listed in our package.json file they get added
to a ".bin" folder inside the "node_modules" folder of our root, this makes them available to our project, all those modules in the .bin folder are automatically in path when we call
 them from the command line in our root project folder.

01. ) This is how we create the "start" script in the package.json file:

    ```
        "scripts": {
          "start": "node buildScripts/srcServer.js"
        },
    ```

      now to run this script we run this in the command line:

      ```
      npm run start
      ```

      or

      ```
      npm start
      ```

      The same applies for "npm test", all other npm scripts must be used with the "run" key word.

01. ) Creating a script that displays a message when running the app:

      we do this by creating a startMessage.js file in the buildScripts folder with the following code:

      ```
      var chalk = require('chalk');
      console.log(chalk.green('Starting app in dev mode...'));
      ```

      then we write an npm script to run it before our app runs, this is done with the prefix "pre", there is also a "post" prefix, these are called hooks, 
      observe the script section of the package.json:

    ```
        "scripts": {
          "prestart": "node buildScripts/startMessage.js",
          "start": "node buildScripts/srcServer.js"
        },
    ```

      the script "prestart" will run before the "start" script, to see this in action run this command:

      ```
      npm start
      ```

01. ) Creating a script that runs the security check in parallel to the start script when the app starts, observe the "script section":

    ```
        "scripts": {
          "prestart": "node buildScripts/startMessage.js",
          "start": "npm-run-all --parallel security-check open:src",
          "open:src": "node buildScripts/srcServer.js",
          "security-check": "nsp check"
        },
    ```


      If you get too much info in the console, use:

      ```
      npm start -s
      ```

      which will run the script in silent mode.

01. ) Creating a script that runs localtunnel in parallel to the start script when the app starts, observe the "script section":

    ```
        "scripts": {
          "prestart": "node buildScripts/startMessage.js",
          "start": "npm-run-all --parallel security-check open:src",
          "open:src": "node buildScripts/srcServer.js",
          "security-check": "nsp check",
          "localtunnel": "lt --port 3000",
          "share": "npm-run-all --parallel open:src localtunnel"
        },
    ```

    This way we avoided opening two terminals at the same time like we did before when setting up localtunnel, we just run:

    ```
    npm run share
    ```

01. ) Creating a script that runs our app with the webpack-dev-server, observe the "script section":

    ```
        "scripts": {
          "prestart": "node buildScripts/startMessage.js",
          "start": "npm-run-all --parallel security-check open:src",
          "open:src": "node buildScripts/srcServer.js",
          "security-check": "nsp check",
          "localtunnel": "lt --port 3000",
          "share": "npm-run-all --parallel open:src localtunnel",
          "serve": "webpack-dev-server --config webpack.config.dev.js"
        },
    ```

    To run the script:

    ```
    npm run serve
    ```

01. ) Creating a script that runs our app with the webpack-dev-server, observe the "script section":

    ```
        "scripts": {
          "prestart": "node buildScripts/startMessage.js",
          "start": "npm-run-all --parallel security-check open:src",
          "open:src": "node buildScripts/srcServer.js",
          "security-check": "nsp check",
          "localtunnel": "lt --port 3000",
          "share": "npm-run-all --parallel open:src localtunnel",
          "clean": "rimraf build",
          "serve": "webpack-dev-server --config webpack.config.dev.js"
        },
    ```

    This script will delete all files in the build directory we use to compile our build files in.

    ```
    npm run clean
    ```

01. ) Our final scripts section in our package.json should look like this:

    ```
    {
      "name": "react-redux-weback2-starter",
      "version": "1.0.0",
      "description": "Starter kit with React, Redux and Webpack2",
      "scripts": {
        "prestart": "babel-node buildScripts/startMessage.js",
        "start": "npm-run-all --parallel security-check open:src",
        "open:src": "babel-node buildScripts/srcServer.js",
        "security-check": "nsp check",
        "localtunnel": "lt --port 3000",
        "share": "npm-run-all --parallel open:src localtunnel",
        "clean": "rimraf build",
        "serve": "webpack-dev-server"
      },
      "author": "Asim Abdelgadir",
      "license": "MIT",
      "dependencies": {
        "babel-polyfill": "6.8.0",
        "bootstrap": "3.3.6",
        "jquery": "2.2.3",
        "numeral": "^2.0.4",
        "react": "15.0.2",
        "react-dom": "15.0.2",
        "react-redux": "4.4.5",
        "react-router": "2.4.0",
        "react-router-redux": "4.0.4",
        "redux": "3.5.2",
        "redux-thunk": "2.0.1",
        "toastr": "2.1.2"
      },
      "devDependencies": {
        "babel-cli": "6.8.0",
        "babel-core": "6.8.0",
        "babel-loader": "6.2.4",
        "babel-plugin-react-display-name": "2.0.0",
        "babel-preset-es2015": "6.6.0",
        "babel-preset-react": "6.5.0",
        "babel-preset-react-hmre": "1.1.1",
        "babel-register": "6.8.0",
        "cheerio": "0.22.0",
        "colors": "1.1.2",
        "compression": "1.6.1",
        "cross-env": "1.0.7",
        "css-loader": "^0.23.1",
        "enzyme": "2.2.0",
        "eslint": "2.9.0",
        "eslint-plugin-import": "1.6.1",
        "eslint-plugin-react": "5.0.1",
        "eslint-watch": "2.1.11",
        "eventsource-polyfill": "0.9.6",
        "expect": "1.19.0",
        "express": "4.13.4",
        "extract-text-webpack-plugin": "1.0.1",
        "file-loader": "0.8.5",
        "html-webpack-plugin": "^2.28.0",
        "image-webpack-loader": "^3.2.0",
        "jsdom": "8.5.0",
        "localtunnel": "^1.8.2",
        "mocha": "2.4.5",
        "nock": "8.0.0",
        "npm-run-all": "1.8.0",
        "nsp": "^2.6.2",
        "open": "0.0.5",
        "react-addons-test-utils": "15.0.2",
        "redux-immutable-state-invariant": "1.2.3",
        "redux-mock-store": "1.0.2",
        "rimraf": "^2.5.2",
        "style-loader": "^0.13.1",
        "url-loader": "^0.5.7",
        "webpack": "^2.2.1",
        "webpack-dev-middleware": "^1.6.1",
        "webpack-dev-server": "^2.4.1",
        "webpack-hot-middleware": "^2.10.0",
        "webpack-md5-hash": "^0.0.5"
      },
      "repository": {
        "type": "git",
        "url": "https://github.com/zonender/react-redux-weback2-starter"
      }
    }
    ```
> **_//==============================================================\\_**
>
> **_CONFIGURING ESLINT_**
>
> **_\\==============================================================//_**

01. ) Create a .eslintrc.json file in the root with the following code: 

    ```
    {
      "root": true,
      "extends": [
        "eslint:recommended",
        "plugin:import/errors",
        "plugin:import/warnings"
      ],
      "parserOptions": {
        "ecmaVersion": 7,
        "sourceType": "module"
      },
      "env": {
        "browser": true,
        "node": true,
        "mocha": true
      },
      "rules": {
        "no-console": 1
      }
    }
    ```

01. ) Then write the following npm script:

    ```
    "scripts": {
      "prestart": "babel-node buildScripts/startMessage.js",
      "start": "npm-run-all --parallel security-check open:src",
      "open:src": "babel-node buildScripts/srcServer.js",
      "security-check": "nsp check",
      "localtunnel": "lt --port 3000",
      "share": "npm-run-all --parallel open:src localtunnel",
      "clean": "rimraf build",
      "serve": "webpack-dev-server",
      "lint": "esw webpack.config.* src buildScripts --color",
      "lint:watch": "npm run lint -- --watch"
    },
    ```

    make sure to disable any linting features your editor may have, otherwise you run the risk of overriding your linting rules with those of the editor's

01. ) We can even have eslint run in watch mode when we run "npm start":

    ```
    "scripts": {
      "prestart": "babel-node buildScripts/startMessage.js",
      "start": "npm-run-all --parallel security-check open:src",
      "open:src": "babel-node buildScripts/srcServer.js",
      "security-check": "nsp check",
      "localtunnel": "lt --port 3000",
      "share": "npm-run-all --parallel open:src localtunnel",
      "clean": "rimraf build",
      "serve": "webpack-dev-server",
      "lint": "esw webpack.config.* src buildScripts --color",
      "lint:watch": "npm run lint -- --watch"
    },
    ```

    make sure to disable any linting features your editor may have, otherwise you run the risk of overriding your linting rules with those of the editor's

> **_//==============================================================\\_**
>
> **_Tweaking WEBPACK.CONFIG.DEV.JS and Creating WEBPACK.CONFIG.PROD.JS_**
>
> **_\\==============================================================//_**

It is good proctise to have two separate webpack.config files, one for the dev env and the other for the prod env.

01. ) Modify the webpack.config.dev.js file as follows:

    ```
    const webpack = require('webpack');
    const path = require('path');
    const htmlWebpackPlugin = require('html-webpack-plugin');

    const config = {
      //The entry point for the bundle.
      entry: {
        bundle: path.resolve(__dirname, 'src/index')
      },
      output: {
        path: path.join(__dirname, 'build'),
        publicPath: '/',
        filename: 'bundle.js'
      },
      module: {
        rules: [
          {
            use: 'babel-loader', //here we are selecting the loader
            test: /\.js$/, //and here we specify which file the loader will process
            exclude: /node_modules/
          },
          {
            test: /\.css$/,
            use: ['style-loader', 'css-loader']
          },
          {
            test: /\.(jpe?g|jpg|png|gif|svg)$/,
            use: [
              {
                loader: 'url-loader'
              },
              'image-webpack-loader'
            ]
          }
        ]
      },
      plugins: [
          //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
          new htmlWebpackPlugin({
                template: 'src/index.html' //if we do not specifiy a template, it will use the default one
          }),
          new webpack.LoaderOptionsPlugin({
            options: {
                noInfo: false,
                debug: true,
                devtool: 'inline-source-map',
                target: 'web'
            }
          })
      ]
    };

    module.exports = config;
    ```

01. ) Create a production webpack config file named: webpack.config.prod.js with the following code:

    ```
    const webpack = require('webpack');
    const path = require('path');
    const htmlWebpackPlugin = require('html-webpack-plugin');

    //our app third party dependencies
    const VENDOR_LIBS = [
          'babel-polyfill', 'bootstrap', 'jquery', 'numeral', 'react', 'react-dom', 'react-redux',
          'react-router', 'react-router-redux', 'redux', 'redux-thunk', 'toastr'
    ];

    const config = {
      entry: {
        bundle: './src/index.js',
        vendor: VENDOR_LIBS
      },
      output: {
        path: path.join(__dirname, 'dist'),
        filename: '[name][chunkhash].js'
        // publicPath: 'build/'
      },
      module: {
        rules: [
          {
            use: 'babel-loader', //here we are selecting the loader
            test: /\.js$/, //and here we specify which file the loader will process
            exclude: /node_modules/
          },
          {
            test: /\.css$/,
            use: ['style-loader', 'css-loader']
          },
          {
            test: /\.(jpe?g|png|gif|svg)$/,
            use: [
              {
                loader: 'url-loader',
                options: { limit: 40000 }
              },
              'image-webpack-loader'
            ]
          }
        ]
      },
      plugins: [
          //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
          new webpack.optimize.CommonsChunkPlugin({
                names: ['vendor', 'manifest']
          }),
          //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
          new htmlWebpackPlugin({
                template: 'src/index.html' //if we do not specifiy a template, it will use the default one
          }),
          new webpack.DefinePlugin({
            'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
          })
        ]
    };

    module.exports = config;
    ```
> **_//==============================================================\\_**
>
> **_Creating a webpack build for production_**
>
> **_\\==============================================================//_**

01. ) Create a build.js file under the buildScripts directory with the following code:

    ```
    /*eslint-disable no-console */
    import webpack from 'webpack';
    import webpackConfig from '../webpack.config.prod';
    import chalk from 'chalk';

    //this is important if you create a dev specific configuration for babel,
    //other libraries might look for this env variable to determine how they get built.
    process.env.NODE_ENV = 'production';

    console.log(chalk.blue('Generating minified bundle for production. This will take a moment...'));

    webpack(webpackConfig).run((err, stats) => {
      if (err) { // so a fatal error occurred. Stop here.
        console.log(chalk.red(err));
        return 1;
      }

      //and these are just warnings errors and stats displayed to the command line:
      const jsonStats = stats.toJson();

      if (jsonStats.hasErrors) {
        return jsonStats.errors.map(error => console.log(chalk.red(error)));
      }

      if (jsonStats.hasWarnings) {
        console.log(chalk.yellow('Webpack generated the following warnings: '));
        jsonStats.warnings.map(warning => console.log(chalk.yellow(warning)));
      }

      console.log(`Webpack stats: ${stats}`);

      // if we got this far, the build succeeded.
      console.log(chalk.green('Your app has been built for production and written to /dist!'));

      return 0;
    });
    ```

01. ) Setup an automated production build:

  01. ) Create a file named "distServer.js" in the buildScripts folder and add this code to it:

      ```
    //this is all we need for our dist server to serve our app locally for dubugging,
    //this is NOT for production, this is just to see how the app looks like on the local machine,
    //and to confirm it works locally.
    //typically these files should be uploaded to some host that will serve them through the internet.
    import express from 'express';
    import path from 'path';
    import open from 'open';
    //we will remove any call for webpack since we will no longer going to be
    //interacting with webpack for our dist server, we are going to be serving the statis
    //built files
    // import webpack from 'webpack';
    // import config from '../webpack.config.dev';

    const port = 3000;
    const app = express();

    //also we should enable gzip compression for our dist server
    app.use(compression());
    //we will have to add support for express for serving static files:
    app.use(express.static('dist'));

    //also remove the call to the compiler
    // const compiler = webpack(config);

    //also remove the call to configue webpack middleware
    // app.use(require('webpack-dev-middleware')(compiler, {
    //   noInfo: true,
    //   publicPath: config.output.publicPath
    // }));

    //and for prod we will be serving html from the dist folder not the src folder
    app.get('/', function(req, res) {
      res.sendFile(path.join(__dirname, '../dist/index.html'));
    });

    app.listen(port, function(err) {
      if (err) {
        console.log(err);
      } else {
        open('http://localhost:' + port);
      }
    });
      ```

      Just like we have a srcServer to serve our src folder, we now have a distServer to serve our dist folder.

  01. ) Create the npm scripts to create our build:

      ```
      "scripts": {
        "prestart": "babel-node buildScripts/startMessage.js",
        "start": "npm-run-all --parallel security-check open:src",
        "open:src": "babel-node buildScripts/srcServer.js",
        "security-check": "nsp check",
        "localtunnel": "lt --port 3000",
        "share": "npm-run-all --parallel open:src localtunnel",
        "clean": "rimraf build",
        "serve": "webpack-dev-server",
        "lint": "esw webpack.config.* src buildScripts --color; exit 0",
        "lint:watch": "npm run lint -- --watch",
        "clean-dist": "rimraf ./dist && mkdir dist",
        "prebuild": "npm-run-all clean-dist lint",
        "build": "babel-node buildScripts/build.js",
        "postbuild": "babel-node buildScripts/distServer.js"
      },
      ```
      To test this run:

      ```
      npm run build
      ```

> **_//==============================================================\\_**
>
> **_Extracting CSS from your bundled JS AND Creating sourcemaps_**
>
> **_\\==============================================================//_**

Currently our css is configured to be bundled within our bundled js, but sometimes you might want to extract css out of the bundled js, for example you can 
utilize cache busting techniques we are using with  other files, to extract css we will use the "ExtractTextPlugin" in our webpack.config.prod.js file, here is the 
modified file:

```
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
      'babel-polyfill', 'bootstrap', 'jquery', 'numeral', 'react', 'react-dom', 'react-redux',
      'react-router', 'react-router-redux', 'redux', 'redux-thunk', 'toastr'
];

const config = {
  devtool: 'source-map',
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'dist'),
    filename: '[name][chunkhash].js'
    // publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        test: /\.css$/,
        loader:  ExtractTextPlugin.extract({loader: 'css-loader?importLoaders=1'})
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      }
    ]
  },
  plugins: [
      // this will grap any css file produced by the css-loader and insert it into the style.css file
      new ExtractTextPlugin({
      filename: '[name][chunkhash].css',
      allChunks: true,
      }),
      //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
      new webpack.optimize.CommonsChunkPlugin({
            names: ['vendor', 'manifest']
      }),
      //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
      new htmlWebpackPlugin({
            template: 'src/index.html' //if we do not specifiy a template, it will use the default one
      }),
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
      })
    ]
};

module.exports = config;
```

References:
https://www.npmjs.com/package/@taion/extract-text-webpack-plugin








https://github.com/zonender/webpack2
//==============================================================\\
//==============================================================\\
                            MY NOTES:
\\==============================================================//
\\==============================================================//

BASIC INSTALLATION AND USE:
===========================================================================
===========================================================================

our project should include a src folder with a simple index.js file with the following code:

=============
const sum = require('./sum');

const total = sum(1, 2);

console.log(total);
==============

And a sum.js file with:

======
const sum = (a, b) => a + b;

module.exports = sum;
======

And a simple index.html file in the root:

==========
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Upstar Music</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script src="dist/bundle.js"></script>
</html>

==========

1) to install webpack:

======
npm install webpack --save-dev
======

USING A CONFIG FILE:
===========================================================================
===========================================================================

1) create a webpack.config.js file with the following code, here we are using the common js module not es6:

THis is the absolute minimum to run webpack.

==========
var webpack = require('webpack');
var path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'dist'),
    filename: 'bundle.js'
  }
};
============

path.resolve makes sure we get the path we need regardless of the OS it is running on.

__dirname = the current directory. (where webpack.config.js is located)

entry: "./src/index.js" is the top level file we want to include in our build.

filename: "bundle.js" is the output file that has includes all out JS code.

2) to create our bundle.js all we have to do is to create an npm "build" script in the package.json file:

==========
var webpack = require('webpack');
var path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'build'),
    filename: 'bundle.js'
  }
};
==========

installing webpack or any other library globally will force your pc to look for the global installation of node_modules under your username folder in your pc, which could
include a large number of modules and libraries, this might be slightly slower, it is best to install it locally using "npm install --save-dev" so that next time you run the command 
npm will look only in our locally installed node_modules, this is faster.

3) to see the html page run the command:

======
start index.html
======

USING WEBPACK IN WATCH MODE:
===========================================================================
===========================================================================

1) add a key called watch in the webpack config:

===========
var webpack = require('webpack');
var path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'build'),
    filename: 'bundle.js'
  },
  watch: true
};
===========

2) run the command:

==========
npm run build
==========

3) do not exit the running webpack command, leave it running and make the changes you wish to you JS files, once you save the changes webpack will automatically run the bundle, to see
the changes on index,html reload the broweser.

USING WEBPACK's DEV SERVER:
===========================================================================
===========================================================================

So far we have been using the file protocal: 

file:///C:/Users/acsaa/Desktop/WebpackFundamentalsCourse/index.html

instead of the http protocal, to use the http protocal we will need to serve the files via a server, we need to install the webpack dev server to do this:

1) install the webpack dev server:

======
npm install webpack-dev-server --save-dev 
======

2) add an npm script:

======
"serve": "webpack-dev-server"
======

3) from within the project directory run:

=====
webpack-dev-server
=====

3) Now we can change the url to: http://localhost:8080/ we can also use: http://localhost:8080/webpack-dev-server/ this will display a status bar on top of the page, the server also
has a hot relod feature, this means you don't have to hit the reload button to see the changes, but it won't open the broweser for you.

Remember webpack will automatically bundle all js files that are required/imported to app.js, and if other files are required in other files related to app.js those will be required as well
but if there is a file that has no require statemnt or import statement then we have to explicitly mention it in the webpack config file as an array value under the entry key, like this:

THIS IS JUST AN EXAMPLE NOT A FILE USED IN THIS PROJECT:

======
module.exports = {
	entry: ["./utils", "./app.js"],
	output: {
		filename: "bundle.js"
	},
	watch: true
}
======

Now webpack will watch our files, and it will automatically reload the page so we can see the update when we save, when we make these small changes it doesn't rebuild the whole project.

also note that if u change webpack config file it won't automatically emit the changes to the browser, u will have to restart the webpack server.

Also note that webpack server will build our project in memory, it doesn't really write to disk, it doesn't create the build directory.

LOADERS FOR TRANSPILING ES6 TO ES5:
===========================================================================
===========================================================================

With loaders we can process files and change them into something else, for example we can use webpack loaders to change es6 files into es5.

before using babel we have to install it:

1) create a file called .babelrc and put this code inside it:

======
{
    "presets": ["babel-preset-env", "react"]
}
======

2) install babel:

======
npm install --save-dev babel-core babel-loader babel-preset-es2015
======

Now we are ready to use babel with webpack.

Now to use our loaders for transpiling:
======================================

1) open the webpack config file and add the key "module" with an array called "rules", as follows:

======
var webpack = require('webpack');
var path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'build'),
    filename: 'bundle.js'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      }
    ]
  },
  watch: false
};
======

2) run the npm command:

======
npm run build
======


3) run the webpack dev server from the command prompt:

======
webpack-dev-server
======


HANDLING CSS WITH WEBPACK (ADDING CSS LOADERS AND INJECTING CSS INSIDE BUNDLE.JS):
===========================================================================
===========================================================================

1) create the file image_viewer.js in the src folder with this code:

======
const image = document.createElement('img');

image.src = 'http://lorempixel.com/400/400'
document.body.appendChild(image);
======

This will display a random image on the screen.

2) Import the image viewer into the index.js file:

======
import sum from './sum';
import './image_viewer'; //we use this from of import when the code we are importing is not 
//producing/returning any value, the image viewr is just generating an image tag in the dom
//also if we do not import this file it will not be executed.

const total = sum(5, 15);

const totaltext = document.createElement('p');
totaltext.innerText = 'The total is:' + total
document.body.appendChild(totaltext);
======

3) Adding css to the image, a red border, we do this by creating the file called image_viewer.css under a folder called styles under the src dir, in the file
put this code:

======
img {
    border: 10px solid red;
}
======

4) now import the newly create css file into the image_viewer.js file like this:

======
import './styles/image_viewer.css';

const image = document.createElement('img');

image.src = 'http://lorempixel.com/400/400'
document.body.appendChild(image);
======

5) now we have to install the css-loaders to teach webpack how to process and read css files and the style-loader so that webpack is able 
to inject them into the html files inside the head tag:

======
npm install --save-dev css-loader style-loader
======

3) Then we have to configure webpack.config.js to process every css file with both the css-loader and the style-loader

======
const webpack = require('webpack');
const path = require('path');
const htmlWebpackPlugin = require('html-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
  'faker', 'lodash', 'react', 'react-dom', 'react-input-range', 'react-redux',
  'react-router', 'redux', 'redux-form', 'redux-thunk'
];

const config = {
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'build'),
    filename: '[name][chunkhash].js'
    // publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
      new webpack.optimize.CommonsChunkPlugin({
            names: ['vendor', 'manifest']
      }),
      //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
      new htmlWebpackPlugin({
            template: 'src/index.html' //if we do not specifiy a template, it will use the default one
      }),
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
      })
    ]
};

module.exports = config;
======

Webpack using css-loader and style-loader has included/injected the style inside the head tag of the index.html, the way it does this is as follows:

The css-loader takes the css code and puts it inside bundle.js and then the style-loader adds its own code to the bundle.js file that injects the css to the dom.

If you don't like this approach you can take another approach and let the loader creeate a separate css file instead of including it in the bundle.js file

4) run: npm run build

5) run: webpack-dev-server

HANDLING CSS WITH WEBPACK (ADDING CSS LOADERS AND CREATING A SEPARATE CSS FILE (FASTER)):
===========================================================================
===========================================================================

1) First we need to add the library called "extract-text-webpack-plugin": 

======
npm install extract-text-webpack-plugin --save-dev
======

if the latest version doesn't work use: npm install extract-text-webpack-plugin@2.0.0-beta.4 --save-dev

or: npm install extract-text-webpack-plugin@^2.0.0-beta --save-dev (This worked for me)

2) we have to include the plugin/library inside the webpack config file, we will also rewrite the config file in ES6 module, the extract-text-webpack-plugin requires 
we fall back to the legacy "loader" key/property instead of the "use" key, in webpack loaders are used for preprocessing and file transforation before including them in the bundle.js file
while plugin usually do not include files in the bundle.js, the extract-text-webpack-plugin will grap any css file produced by the css-loader and insert it into the style.css file:

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
  'faker', 'lodash', 'react', 'react-dom', 'react-input-range', 'react-redux',
  'react-router', 'redux', 'redux-form', 'redux-thunk'
];

const config = {
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'build'),
    filename: '[name][chunkhash].js'
    // publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        test: /\.css$/,
        loader:  ExtractTextPlugin.extract({loader: 'css-loader?importLoaders=1'})
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      // this will grap any css file produced by the css-loader and insert it into the style.css file
      new ExtractTextPlugin({
      filename: '[name][chunkhash].css',
      allChunks: true,
      }),
      //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
      new webpack.optimize.CommonsChunkPlugin({
            names: ['vendor', 'manifest']
      }),
      //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
      new htmlWebpackPlugin({
            template: 'src/index.html' //if we do not specifiy a template, it will use the default one
      }),
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
      })
    ]
};

module.exports = config;
======

3) run:

======
npm run build
======

to create the build and the style.css file.

4) Add a link tag in the index.html file, to reference the style.css file:

======
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Upstar Music</title>
  </head>
  <body>
    <p>Hello Webpack</p>
    <div id="root"></div>
  </body>
</html>
======

HANDLING IMAGES WITH WEBPACK:
===========================================================================
===========================================================================

The image image_viewer is currently relying on an outside source for it's images, which makes it lag, we will now see how to handle images locally and include them in our build pipeline.

We will be using the image-webpack-loader, the loader will compress the image and include it in the bundle.js if it is small (smaller than 40000 bytes). and will output it to the build directory if the image is large.

1) Install the loaders:

======
npm install --save-dev image-webpack-loader url-loader
======

2) edit the webpack config by adding the loaders:

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');

const config = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'build'),
    filename: 'bundle.js'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/ //and here we specify which file the loader will process 
      },
      {
        loader: ExtractTextPlugin.extract ({
          loader: 'css-loader'
        }),
        test: /\.css$/ //now any css file will be processed with both css and style loader
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: {limit: 40000}
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      new ExtractTextPlugin('style.css') // this will grap any css file produced by the css-loader and inserted into the style.css file
    ]
};

module.exports = config;
======

3) Download a small image from: http://lorempixel.com/200/200/ and a large image from http://lorempixel.com/1200/1200/ and save them to an assets directory
located in the root that you must create.

4) import these two images to the image_viewer.js file:

======
import big from '../assets/big.jpg'
import small from '../assets/small.jpg'
import './styles/image_viewer.css';

const image = document.createElement('img');

image.src = 'http://lorempixel.com/400/400'
document.body.appendChild(image);
======

5) run the build:

======
npm run build
======

You will notice that the large jpg file has been added in the build directory because it exceeds 40000 bytes, and if you open the bundle.js file 
and find the string: "data:image/jpeg;base64" you will notice that the image has been converted to a base64 string.

6) to use the images edit the image_viewer.js as follows:

======
import big from '../assets/big.jpg';
import small from '../assets/small.jpg';
import './styles/image_viewer.css';

const smallImage = document.createElement('img');
smallImage.src = small;
document.body.appendChild(smallImage);

const bigImage = document.createElement('img');
bigImage.src = big;
document.body.appendChild(bigImage);
======

7) add the public path property to the webpack config file:

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');

const config = {
  entry: './src/index.js',
  output: {
    path: path.join(__dirname, 'build'),
    filename: 'bundle.js',
    publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/ //and here we specify which file the loader will process 
      },
      {
        loader: ExtractTextPlugin.extract ({
          loader: 'css-loader'
        }),
        test: /\.css$/ //now any css file will be processed with both css and style loader
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      new ExtractTextPlugin('style.css') // this will grap any css file produced by the css-loader and inserted into the style.css file
    ]
};

module.exports = config;
======

8) run the build:

======
npm run build
======

9) run the webpack server:

======
webpack-dev-server
======

CODE SPLITTING WITH WEBPACK:
===========================================================================
===========================================================================

1) fisrt we will adjust the code in the image_viewer.js module to return only the small image and we will also adjust the code so that instead of 
displaying the image on the screen the instant the code is executed we export the function so we can call it anytime and anywhere we want, so basically
we wrapped the logic that displays the image in a arrow function.

======
import small from '../assets/small.jpg';
import './styles/image_viewer.css';

export default () => {
    const smallImage = document.createElement('img');
    smallImage.src = small;
    document.body.appendChild(smallImage);
};
======

2) remove all the code under index.js and replace it with this one:

======
const button = document.createElement('button');
button.innerText = 'Click me';
button.onclick = () => {
    System.import('./image_viewer').then(module => {
        module.default();
    });
};

document.body.appendChild(button);
======

on the click event a call is made asking the server to retreive the image_viewer.js module/code and execute it, note that if the image_viewer.js has its own 
imports those imported modules/code will be pulled in as well.

The click event triggers an asynchronous call (system.import('./image_viewer')) this will take time for the browser to reah out to the server and get that code, because this
is an asynchronus call the (system.import('./image_viewer')) returns a promise and to get access to the image_viewer.js module/code we need to add .then so the
code becomes: (system.import('./image_viewer').then), the .then will wait untill the server returns the code and store it in a module function, to see what this function will return 
we can console.log it as follows then build the code and run the webpack server and then open the console then click the button to see the result of console.log(module):

======
const button = document.createElement('button');
button.innerText = 'Click me';
button.onclick = () => {
    System.import('./image_viewer').then(module => {
        console.log(module)
    });
};

document.body.appendChild(button);
======

====================================================================================================
PLEASE NOTE THAT: System.import with a capital S is not the same as system.import with lower case s.
====================================================================================================

Now we can change the code back to:

======
const button = document.createElement('button');
button.innerText = 'Click me';
button.onclick = () => {
    System.import('./image_viewer').then(module => {
        module.default();
    });
};

document.body.appendChild(button);
======

3) build then run

ADVANCED FEATURES OF WEBPACK CODE SPLITTING USING THE VENDOR KEY:
===========================================================================
===========================================================================

1) here we are splitting our code between two files, bundle.js and vendor.js.

bundle.js will include all our app specific code and evey other code/modules it needs.

vendor.js will include third party modules required to run our app, you will find these under the dependencies section of our package.json.

modules under vendor.js will not be updated often, so if you have a third party module that you need to update often then include it in the bundle.js 
by removing it from the VENDOR_LIBS array in the webpack.config.js file.

however, if you are including/importing any module defined under the VENDOR_LIBS array in your entry point (index.js) webpack will still include these third party modules
in the bundle.js on top of vendors.js even though we spedifically told webpack to do that in the VENDOR_LIBS array in the webpack.config.js file, this will create a duplication
 of those modules in both bundle.js and vendor.js, to enforce this separation and make sure webpack includes these third party modules only in vendor.js and not dupliacte them
 in the bundle.js we will have to use the plugin defined in the plugin section of the webpack config file.

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
  'faker', 'lodash', 'react', 'react-dom', 'react-input-range', 'react-redux',
  'react-router', 'redux', 'redux-form', 'redux-thunk'
];

const config = {
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'build'),
    filename: '[name].js',
    publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        loader: ExtractTextPlugin.extract ({
          loader: 'css-loader'
        }),
        test: /\.css$/ //now any css file will be processed with both css and style loader
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      new ExtractTextPlugin('style.css'), // this will grap any css file produced by the css-loader and inserted into the style.css file
      new webpack.optimize.CommonsChunkPlugin({
        name: 'vendor'
      })
    ]
};

module.exports = config;
======

2) add both scripts to the html, make sure the vendors script comes before the bundle script:

======
<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="build/style.css"></link>
    <meta charset="UTF-8">
    <title>Upstar Music</title>
  </head>
  <body>
    <p>Hello Webpack!!!</p>
    <div id="root"></div>
  </body>
  <script src="/build/vendor.js"></script>
  <script src="/build/bundle.js"></script>
</html>
======

3) To avoid manually inserting the vendor and bundle files in the index.html we will use the plugin html-webpack-plugin, first we have to install it:

======
npm install --save-dev html-webpack-plugin
======

then include it in the webpack config file:

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
  'faker', 'lodash', 'react', 'react-dom', 'react-input-range', 'react-redux',
  'react-router', 'redux', 'redux-form', 'redux-thunk'
];

const config = {
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'build'),
    filename: '[name].js',
    publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        loader: ExtractTextPlugin.extract ({
          loader: 'css-loader'
        }),
        test: /\.css$/ //now any css file will be processed with both css and style loader
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      // this will grap any css file produced by the css-loader and insert it into the style.css file
      new ExtractTextPlugin('style.css'),
      //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
      new webpack.optimize.CommonsChunkPlugin({
            name: 'vendor'
        }),
      //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
      new htmlWebpackPlugin({
            template: 'src/index.html' //if we do not specifiy a template, it will use the default one
        })
    ]
};

module.exports = config;
======

Now we can remove the scripts tags we were using, since the plugin will insert them for us in the correct order, we also moved the index.html file into the src directory.

======
<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="build/style.css"></link>
    <meta charset="UTF-8">
    <title>Upstar Music</title>
  </head>
  <body>
    <p>Hello Webpack!!!</p>
    <div id="root"></div>
  </body>
</html>
======

4) finally create the build and run the app.

CACHE BUSTING:
===========================================================================
===========================================================================

The browser will only download a file when its name changes, so by changing the name of bundle.js or vendor.js everytime we change these files we will make
sure the browser will download the latest version, we do this by adding a hash to the file name:

1) we add a chunkhash to the filename key as follows in the webpack config file:

======
const webpack = require('webpack');
const path = require('path');
const ExtractTextPlugin = require('extract-text-webpack-plugin');
const htmlWebpackPlugin = require('html-webpack-plugin');

//our app third party dependencies
const VENDOR_LIBS = [
  'faker', 'lodash', 'react', 'react-dom', 'react-input-range', 'react-redux',
  'react-router', 'redux', 'redux-form', 'redux-thunk'
];

const config = {
  entry: {
    bundle: './src/index.js',
    vendor: VENDOR_LIBS
  },
  output: {
    path: path.join(__dirname, 'build'),
    filename: '[name][chunkhash].js'
    // publicPath: 'build/'
  },
  module: {
    rules: [
      {
        use: 'babel-loader', //here we are selecting the loader 
        test: /\.js$/, //and here we specify which file the loader will process
        exclude: /node_modules/
      },
      {
        use: ['style-loader', 'css-loader'],
        test: /\.css$/ //now any css file will be processed with both css and style loader
      },
      {
        test: /\.(jpe?g|png|gif|svg)$/,
        use: [
          {
            loader: 'url-loader',
            options: { limit: 40000 }
          },
          'image-webpack-loader'
        ]
      } 
    ]
  },
  plugins: [
      // this will grap any css file produced by the css-loader and insert it into the style.css file
      new ExtractTextPlugin('style.css'),
      //this plugin will make sure there is no duplicate modules between vendor.js and bundle.js if there are it will remove them from bundle.js and put them in vendor.js
      new webpack.optimize.CommonsChunkPlugin({
            names: ['vendor', 'manifest']
        }),
      //this plugin will insert the script tags for bundle.js and vendor.js in our index.html
      new htmlWebpackPlugin({
            template: 'src/index.html' //if we do not specifiy a template, it will use the default one
        })
    ]
};

module.exports = config;
======

CLEANUP:
===========================================================================
===========================================================================

As we keep rebuilding builds our build or dist directory will grow, so we have to clean it up before making any build. we will install rimraf:

1) install rimraf:

======
npm install rimraf --save-dev
======

2) we will add an npm script:

======
"clean": "rimraf build"
"build": "npm run clean && webpack"
======

PREPARING OUR APP FOR DEPLOYMENT:
===========================================================================
===========================================================================

1) we add the following plugin to our webpack config file:

when reactjs runs it looks for this window scoped variable called process.env.NODE_ENV, if the value of this varaible is production react will not do too many error checking procedures,
which also takes too long to run.

======
      new webpack.DefinePlugin({
        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV)
      })
======

2) Then we set the env variable during the build script in package.json:

For iOS and Linux
======
"build": "NODE_ENV=production npm run clean && webpack",
======

For windows:
======
"build": "SET NODE_ENV=production npm run clean && webpack",
======


this is where we set the value of the variable: JSON.stringify(process.env.NODE_ENV)

If we build the app without defining the variable process.env.NODE_ENV reactjs will run with full error checking 

3) in the package.json build script we also need to add the switch -p, this tells webpack to run in production mode and create a production version of the app, when in 
production mode, it will automatically minify our code and make the files smaller, it will also mean the build process will be longer.

For iOS and Linux
======
"build": "NODE_ENV=production npm run clean && webpack -p",
======

For windows:
======
"build": "SET NODE_ENV=production npm run clean && webpack -p",
======

DEPLOYMENT FOR STATIC SITES (USING SURGE):
===========================================================================
===========================================================================

1) install surge cli:

======
npm install -g surge
======

2) run a build:

======
npm run build
======

3) run the command:

======
surge -p build
======



